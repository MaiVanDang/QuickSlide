-- QuickSlideP2 - Schema DDL (PostgreSQL)
-- Generated from backend JPA entities under backend/src/main/java/com/hust/entity
-- Note: Project currently uses Hibernate ddl-auto=update (no Flyway/Liquibase migrations found).

BEGIN;

-- 1) users
CREATE TABLE IF NOT EXISTS users (
    id           bigserial PRIMARY KEY,
    username     varchar(255) NOT NULL,
    email        varchar(255) NOT NULL,
    password_hash varchar(255) NOT NULL,
    settings_json text,
    created_at   timestamptz,
    updated_at   timestamptz,
    CONSTRAINT uk_users_username UNIQUE (username),
    CONSTRAINT uk_users_email UNIQUE (email)
);

-- 2) themes
CREATE TABLE IF NOT EXISTS themes (
    id            bigserial PRIMARY KEY,
    name          varchar(255),
    primary_color varchar(255),
    font_stack    varchar(255),
    is_public     boolean
);

-- 3) templates
CREATE TABLE IF NOT EXISTS templates (
    id                bigserial PRIMARY KEY,
    owner_id          bigint NOT NULL,
    name              varchar(255) NOT NULL,
    description       varchar(255),
    theme             varchar(255),
    is_public         boolean,
    is_deleted        boolean,
    preview_image_url text,
    created_at        timestamptz,
    edited_at         timestamptz,
    CONSTRAINT fk_templates_owner FOREIGN KEY (owner_id) REFERENCES users (id)
);

-- 4) template_slides
CREATE TABLE IF NOT EXISTS template_slides (
    id          bigserial PRIMARY KEY,
    template_id bigint NOT NULL,
    layout_json text,
    slide_order integer,
    created_at  timestamptz,
    CONSTRAINT fk_template_slides_template FOREIGN KEY (template_id) REFERENCES templates (id)
);

-- 5) presentations
CREATE TABLE IF NOT EXISTS presentations (
    id                   bigserial PRIMARY KEY,
    owner_id             bigint NOT NULL,
    title                varchar(255) NOT NULL,
    based_on_template_id bigint,
    created_at           timestamptz,
    edited_date          timestamptz,
    CONSTRAINT fk_presentations_owner FOREIGN KEY (owner_id) REFERENCES users (id),
    CONSTRAINT fk_presentations_based_on_template FOREIGN KEY (based_on_template_id) REFERENCES templates (id)
);

-- 6) slides
CREATE TABLE IF NOT EXISTS slides (
    id              bigserial PRIMARY KEY,
    presentation_id bigint NOT NULL,
    slide_index     integer NOT NULL,
    content_json    text,
    layout_used_id  bigint,
    last_modified   timestamptz,
    CONSTRAINT fk_slides_presentation FOREIGN KEY (presentation_id) REFERENCES presentations (id),
    CONSTRAINT fk_slides_layout_used FOREIGN KEY (layout_used_id) REFERENCES template_slides (id)
);

-- 7) history_logs
CREATE TABLE IF NOT EXISTS history_logs (
    id          bigserial PRIMARY KEY,
    user_id     bigint NOT NULL,
    action_type varchar(255) NOT NULL,
    entity_type varchar(255),
    entity_id   bigint,
    "timestamp"  timestamptz,
    CONSTRAINT fk_history_logs_user FOREIGN KEY (user_id) REFERENCES users (id)
);

COMMIT;
